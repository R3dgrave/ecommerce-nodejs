components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # --- USUARIOS ---
    User:
      type: object
      properties:
        id: { type: string, example: "64f1a2b3c4d5e6f7a8b9c0d1" }
        name: { type: string, example: "Juan Perez" }
        email: { type: string, example: "juan@example.com" }
        isAdmin: { type: boolean, example: false }

    RegisterResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string, example: "Usuario registrado exitosamente." }
        data: { $ref: "#/components/schemas/User" }

    LoginResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        data:
          type: object
          properties:
            token: { type: string, example: "eyJhbGciOiJIUzI1Ni..." }
            user: { $ref: "#/components/schemas/User" }

    UserResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        data: { $ref: "#/components/schemas/User" }

    # --- RESPUESTAS GENERALES ---
    GeneralResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string, example: "Operación realizada con éxito" }

    ErrorResponse:
      type: object
      properties:
        success: { type: boolean, example: false }
        error: { type: string, example: "Mensaje de error descriptivo" }
        details:
          type: array
          description: "Presente solo en errores de validación (400)"
          items:
            type: object
            properties:
              msg: { type: string, example: "El campo es requerido" }
              param: { type: string, example: "email" }
              location: { type: string, example: "body" }

    # --- CATÁLOGO ---
    Brand:
      type: object
      properties:
        id: { type: string, example: "64f1a2b3c4d5e6f7a8b9c111" }
        name: { type: string, example: "Nike" }
        categoryId: { type: string, example: "64f1a2b3c4d5e6f7a8b9c0d1" }

    BrandResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        brand: { $ref: "#/components/schemas/Brand" }

    BrandListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        result:
          type: object
          properties:
            data:
              type: array
              items: { $ref: "#/components/schemas/Brand" }
            totalCount: { type: integer, example: 10 }
            totalPages: { type: integer, example: 1 }
            currentPage: { type: integer, example: 1 }

    Category:
      type: object
      properties:
        id: { type: string, example: "64f1a2b3c4d5e6f7a8b9c0d1" }
        name: { type: string, example: "electronics" }

    CategoryResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        result: { $ref: "#/components/schemas/Category" }

    CategoryListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        result:
          type: object
          properties:
            data:
              type: array
              items: { $ref: "#/components/schemas/Category" }
            totalCount: { type: integer, example: 50 }
            totalPages: { type: integer, example: 5 }

    Product:
      type: object
      properties:
        id: { type: string, example: "64f1a2b3c4d5e6f7a8b9c222" }
        name: { type: string, example: "Zapatillas Running X" }
        price: { type: number, example: 89.99 }
        stock: { type: integer, example: 50 }
        categoryId:
          {
            oneOf:
              [{ type: string }, { $ref: "#/components/schemas/Category" }],
          }
        brandId:
          { oneOf: [{ type: string }, { $ref: "#/components/schemas/Brand" }] }

    ProductResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string, example: "Operación realizada" }
        result: { $ref: "#/components/schemas/Product" }

    ProductListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        result:
          type: object
          properties:
            data:
              type: array
              items: { $ref: "#/components/schemas/Product" }
            totalCount: { type: integer, example: 100 }
            totalPages: { type: integer, example: 10 }
            page: { type: integer, example: 1 }

    # --- ESQUEMAS DE CARRITO ---
    CartItem:
      type: object
      properties:
        productId:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/Product"
        quantity:
          type: integer
          example: 2
        price:
          type: number
          example: 45.5

    Cart:
      type: object
      properties:
        id:
          type: string
          example: "64f1a2b3c4d5e6f7a8b9c333"
        userId:
          type: string
          example: "64f1a2b3c4d5e6f7a8b9c0d1"
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        totalAmount:
          type: number
          example: 91.0

    # --- RESPUESTA ENVOLTORIO PARA CARRITO ---
    CartResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operación realizada correctamente"
        result:
          $ref: "#/components/schemas/Cart"        

    # --- PEDIDOS Y CARRITO ---
    OrderItem:
      type: object
      properties:
        productId: { type: string, example: "64f1a2b3c4d5e6f7a8b9c222" }
        name: { type: string, example: "PlayStation 5" }
        price: { type: number, example: 499.99 }
        quantity: { type: integer, example: 1 }

    ShippingAddress:
      type: object
      required: [address, city, country]
      properties:
        address: { type: string, example: "Calle Principal 123" }
        city: { type: string, example: "Santiago" }
        country: { type: string, example: "Chile" }

    Order:
      type: object
      properties:
        id: { type: string, example: "64f1a2b3c4d5e6f7a8b9c444" }
        userId: { type: string, example: "64f1a2b3c4d5e6f7a8b9c0d1" }
        items:
          { type: array, items: { $ref: "#/components/schemas/OrderItem" } }
        totalAmount: { type: number, example: 499.99 }
        shippingAddress: { $ref: "#/components/schemas/ShippingAddress" }
        status:
          type: string
          enum: [pending, paid, shipped, delivered, cancelled]
          example: "pending"

    # --- RESPUESTAS DE ÓRDENES ---
    OrderResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operación realizada con éxito"
        data:
          $ref: "#/components/schemas/Order"

    OrderListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Órdenes recuperadas"
        data:
          type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/Order"
            totalCount:
              type: integer
              example: 5
            totalPages:
              type: integer
              example: 1
            page:
              type: string
              example: "1"

    # --- PAGOS (STRICTAMENTE SEGÚN TU CONTROLADOR) ---
    PaymentIntentRequest:
      type: object
      required: [orderId]
      properties:
        orderId: { type: string, example: "64f1a2b3c4d5e6f7a8b9c444" }

    PaymentIntentResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        data:
          type: object
          properties:
            clientSecret: { type: string, example: "pi_3N4x5yL2eZv..." }
            amount: { type: number, example: 499.99 }
            currency: { type: string, example: "usd" }

    RefundRequest:
      type: object
      required: [orderId]
      properties:
        orderId: { type: string, example: "64f1a2b3c4d5e6f7a8b9c444" }
        reason:
          type: string
          enum: [duplicate, fraudulent, requested_by_customer, abandoned]
          example: "requested_by_customer"

    RefundResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string, example: "Refund processed" }
        data:
          type: object
          properties:
            id: { type: string, example: "re_3N4x5yL2eZv..." }
            status: { type: string, example: "succeeded" }
